var RuChat=angular.module("RuChat",["ngRoute"]);RuChat.config(function(e){e.when("/login",{templateUrl:"partials/login.html",controller:"loginController"}).when("/rooms/:user",{templateUrl:"partials/rooms.html",controller:"roomsController"}).when("/room/:user/:room/",{templateUrl:"partials/room.html",controller:"roomController"}).otherwise({redirectTo:"/login"})}),RuChat.controller("loginController",function(e,o,r,s,n){e.errorMessage="",e.nickname="",e.login=function(){if(""===e.nickname)e.errorMessage="Please choose a username before continuing!";else{var r=e.nickname;n.emit("adduser",r,function(r){r?o.path("/rooms/"+e.nickname):e.errorMessage="This username is already taken!"})}}}),RuChat.controller("roomsController",function(e,o,r,s,n){e.currentUser=s.user,e.allUsers=[],n.emit("rooms"),n.on("roomlist",function(o){e.rooms=Object.keys(o)}),n.emit("users"),n.on("userlist",function(o){for(var r=0;r<o.length;++r)e.allUsers[r]=o[r]}),e.createRoom=function(){n.emit("rooms"),o.path("/room/"+e.currentUser+"/"+e.roomName)}}),RuChat.controller("roomController",function(e,o,r,s,n){e.currentRoom=s.room,e.currentUser=s.user,e.currentUsers=[],e.errorMessage="",e.allMessages=[],e.allRoomUsers=[],e.serverMessage="";var t={room:e.currentRoom};n.emit("joinroom",t,function(o,r){o||(e.errorMessage=r),a()}),n.on("updateusers",function(){n.emit("rooms")}),n.on("servermessage",function(o,r,s){"join"===o?e.serverMessage=s+" just joined "+r:"part"===o&&(e.serverMessage=s+" just left "+r),e.allMessages.push(e.serverMessage);for(var n=0;n<e.allMessages.length;n++)console.log(e.allMessages[n])}),e.leaveRoom=function(){m(),n.emit("partroom",e.currentRoom),o.path("/rooms/"+e.currentUser)},n.emit("rooms"),n.on("roomlist",function(o){e.currentUsers=o[e.currentRoom].users,e.allMessages=o[e.currentRoom].messageHistory,e.roomTopic=o[e.currentRoom].topic}),e.sendMsg=function(){var o={roomName:e.currentRoom,msg:e.message};n.emit("sendmsg",o),e.message=""};var a=function(){var o={roomName:e.currentRoom,msg:"Joined Room"};n.emit("sendmsg",o)},m=function(){var o={roomName:e.currentRoom,msg:"Left Room"};n.emit("sendmsg",o)};n.on("updatechat",function(o,r){for(var s=0;s<r.length;s++)e.allMessages[s]=r[s]})});